function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-CpKv2VDw.js","assets/_commonjsHelpers-Cpj98o6Y.js","assets/index-yFZ5sogW.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
var h=Object.defineProperty;var g=(e,r,t)=>r in e?h(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t;var m=(e,r,t)=>(g(e,typeof r!="symbol"?r+"":r,t),t);(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let e=0;e<256;++e)byteToHex.push((e+256).toString(16).slice(1));function unsafeStringify(e,r=0){return byteToHex[e[r+0]]+byteToHex[e[r+1]]+byteToHex[e[r+2]]+byteToHex[e[r+3]]+"-"+byteToHex[e[r+4]]+byteToHex[e[r+5]]+"-"+byteToHex[e[r+6]]+byteToHex[e[r+7]]+"-"+byteToHex[e[r+8]]+byteToHex[e[r+9]]+"-"+byteToHex[e[r+10]]+byteToHex[e[r+11]]+byteToHex[e[r+12]]+byteToHex[e[r+13]]+byteToHex[e[r+14]]+byteToHex[e[r+15]]}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID};function v4(e,r,t){if(native.randomUUID&&!r&&!e)return native.randomUUID();e=e||{};const n=e.random||(e.rng||rng)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,r){t=t||0;for(let o=0;o<16;++o)r[t+o]=n[o];return r}return unsafeStringify(n)}const SCRIPT_INIT_EXECUTE="init_execute",scriptRel="modulepreload",assetsURL=function(e){return"/"+e},seen={},__vitePreload=function(r,t,n){let o=Promise.resolve();if(t&&t.length>0){const s=document.getElementsByTagName("link"),i=document.querySelector("meta[property=csp-nonce]"),p=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));o=Promise.all(t.map(a=>{if(a=assetsURL(a),a in seen)return;seen[a]=!0;const l=a.endsWith(".css"),y=l?'[rel="stylesheet"]':"";if(!!n)for(let u=s.length-1;u>=0;u--){const d=s[u];if(d.href===a&&(!l||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${y}`))return;const c=document.createElement("link");if(c.rel=l?"stylesheet":scriptRel,l||(c.as="script",c.crossOrigin=""),c.href=a,p&&c.setAttribute("nonce",p),document.head.appendChild(c),l)return new Promise((u,d)=>{c.addEventListener("load",u),c.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${a}`)))})}))}return o.then(()=>r()).catch(s=>{const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=s,window.dispatchEvent(i),!i.defaultPrevented)throw s})};var RequestType;(function(e){e.INTROSPECTION="introspection",e.QUERY="query",e.SUBSCRIPTION="subscription"})(RequestType||(RequestType={}));class ScriptEvaluatorWorker{}const ModuleImports={atob:{async exec(){return(await __vitePreload(()=>import("./index-CpKv2VDw.js").then(e=>e.i),__vite__mapDeps([0,1]))).atob}},btoa:{async exec(){return(await __vitePreload(()=>import("./index-CpKv2VDw.js").then(e=>e.i),__vite__mapDeps([0,1]))).btoa}},"crypto-js":{async exec(){return(await __vitePreload(()=>import("./index-yFZ5sogW.js").then(e=>e.i),__vite__mapDeps([2,1]))).default}}},buildContextResponse=e=>{if(e.response)return{body:e.response.body,requestType:e.requestType??RequestType.QUERY,responseTime:e.response.responseTime,statusCode:e.response.status,headers:e.response.headers}},importModuleHelper=async e=>{const r=ModuleImports[e];if(!r)throw new Error(`No request script module found matching "${e}"`);return r.exec()},getGlobalContext=(e,r)=>({data:e,helpers:{getEnvironment:t=>e.environment[t],setEnvironment:(t,n,o=!1)=>{e.environment[t]=n,o&&(e.__toSetActiveEnvironment=e.__toSetActiveEnvironment??{},e.__toSetActiveEnvironment[t]=n)},getCookie:t=>{var n;return((n=e.__cookieJar)==null?void 0:n[t])??""},setCookie:(t,n,o)=>{r.setCookie(t,n,o)},request:async(t,n,o)=>r.request(t,n,o)},storage:{get:t=>r.getStorageItem(t),set:(t,n)=>r.setStorageItem(t,n)},importModule:t=>importModuleHelper(t),response:buildContextResponse(e),log:t=>{e.requestScriptLogs=e.requestScriptLogs??[],e.requestScriptLogs.push({time:Date.now(),text:JSON.stringify(t,null,2),source:"Request script"})}}),workerHandlerNames=["setCookie","request","getStorageItem","setStorageItem"];class ScriptEvaluatorWorkerEngine{constructor(e){this.worker=e}start(){this.worker.onMessage(async e=>{switch(e.type){case SCRIPT_INIT_EXECUTE:try{await this.initExecute(e.payload)}catch(r){await this.makeCall("scriptError",r)}break}})}async initExecute(payload){const[script,data]=payload,res=await new Promise((resolve,reject)=>{this.worker.onError(e=>{reject(e)});const clonedMutableData=JSON.parse(JSON.stringify(data)),handlers=workerHandlerNames.reduce((e,r)=>(e[r]=(...t)=>this.makeCall(r,...t),e),{}),context={altair:getGlobalContext(clonedMutableData,handlers),alert:e=>this.makeCall("alert",e)},contextEntries=Object.entries(context);try{const res=(function(){return eval(`
          (async(${contextEntries.map(e=>e[0]).join(",")}) => {
            ${script};
            return altair.data;
          })(...this.__ctxE.map(e => e[1]));
        `)}).call({__ctxE:contextEntries});return resolve(res)}catch(e){return reject(e)}});res.__toSetActiveEnvironment&&this.makeCall("updateActiveEnvironment",res.__toSetActiveEnvironment),this.makeCall("executeComplete",res)}makeCall(e,...r){return new Promise((t,n)=>{const o=v4();this.worker.onMessage(s=>{switch(s.type){case`${e}_response`:return s.payload.id!==o?void 0:t(s.payload.response);case`${e}_error`:return s.payload.id!==o?void 0:n(s.payload.error)}}),this.worker.send(e,{id:o,args:r})})}}class EvaluatorFrameWorker extends ScriptEvaluatorWorker{constructor(){super();m(this,"origin");const n=new URLSearchParams(window.location.search).get("sc");if(!n)throw new Error("Invalid source provided!");this.origin=n}onMessage(t){window.addEventListener("message",n=>{n.origin===this.origin&&t(n.data)})}send(t,n){window.parent.postMessage({type:t,payload:n},this.origin)}onError(t){window.addEventListener("error",t),window.addEventListener("unhandledrejection",n=>{n.preventDefault(),t(n.reason)})}}const injectScript=e=>new Promise((r,t)=>{const n=document.getElementsByTagName("head")[0];if(!n)return t(new Error("No head found!"));const o=document.createElement("script");o.type="text/javascript",o.src=e,o.crossOrigin="anonymous",o.onload=()=>r(null),o.onerror=s=>t(s),n.appendChild(o)}),injectStylesheet=e=>new Promise((r,t)=>{const n=document.getElementsByTagName("head")[0];if(!n)return t(new Error("No head found!"));const o=document.createElement("link");o.type="text/css",o.rel="stylesheet",o.crossOrigin="anonymous",o.href=e,o.onload=()=>r(null),o.onerror=s=>t(s),n.appendChild(o)}),handlePluginSandbox=async()=>{const r=new URLSearchParams(window.location.search).get("plugin_sandbox_opts"),t=r?JSON.parse(r):void 0;if(!t)throw new Error("Invalid plugin options provided!");if(t.type!=="scripts")throw new Error("Invalid plugin option type provided!");if(document.querySelectorAll('style,link[rel="stylesheet"]').forEach(n=>n.remove()),t.styleUrls)for(const n of t.styleUrls)await injectStylesheet(n);if(t.scriptUrls)for(const n of t.scriptUrls)await injectScript(n)},searchParams=new URLSearchParams(window.location.search),sandboxType=searchParams.get("sandbox_type");switch(sandboxType){case"plugin":handlePluginSandbox();break;case"script":default:new ScriptEvaluatorWorkerEngine(new EvaluatorFrameWorker).start()}
