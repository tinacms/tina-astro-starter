!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((n="undefined"!=typeof globalThis?globalThis:n||self).jotaiVanilla={})}(this,(function(n){"use strict";var r=0;function e(n){return n(this)}function t(n,r,e){return r(this,"function"==typeof e?e(n(this)):e)}function a(n,r){(null==r||r>n.length)&&(r=n.length);for(var e=0,t=Array(r);e<r;e++)t[e]=n[e];return t}function o(n,r){var e="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(e)return(e=e.call(n)).next.bind(e);if(Array.isArray(n)||(e=function(n,r){if(n){if("string"==typeof n)return a(n,r);var e={}.toString.call(n).slice(8,-1);return"Object"===e&&n.constructor&&(e=n.constructor.name),"Map"===e||"Set"===e?Array.from(n):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?a(n,r):void 0}}(n))||r){e&&(n=e);var t=0;return function(){return t>=n.length?{done:!0}:{done:!1,value:n[t++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=function(n,r){return n.unstable_is?n.unstable_is(r):r===n},f=function(n){return"init"in n},l=function(n){return!!n.write},v=new WeakMap,c=function(n){var r;return d(n)&&!(null!=(r=v.get(n))&&r[1])},d=function(n){return"function"==typeof(null==n?void 0:n.then)},s=function(n){return"v"in n||"e"in n},y=function(n){if("e"in n)throw n.e;return n.v},p=function(n,r,e){e.p.has(n)||(e.p.add(n),r.then((function(){e.p.delete(n)}),(function(){e.p.delete(n)})))},h=function(n,r,e,t,a){var o;e.d.set(t,a.n),c(e.v)&&p(r,e.v,a),null==(o=a.m)||o.t.add(r),n&&g(n,t,r)},m=function(){return[new Map,new Map,new Set]},w=function(n,r,e){n[0].has(r)||n[0].set(r,new Set),n[1].set(r,e)},g=function(n,r,e){var t=n[0].get(r);t&&t.add(e)},b=function(n,r){n[2].add(r)},S=function(n){for(var r,e=!1,t=function(n){try{n()}catch(n){e||(r=n,e=!0)}};n[1].size||n[2].size;){n[0].clear();var a=new Set(n[1].values());n[1].clear();var o=new Set(n[2]);n[2].clear(),a.forEach((function(n){var r;return null==(r=n.m)?void 0:r.l.forEach(t)})),o.forEach(t)}if(e)throw r},A=function(){for(var n=arguments.length,r=new Array(n),e=0;e<n;e++)r[e]=arguments[e];var t=r[0],a=r[1],i=r[2],g=r[3],k=function(n,r,e){var a,i,u,f="v"in r,l=r.v,s=c(r.v)?r.v:null;if(d(e)){!function(n){if(!v.has(n)){var r=[new Set,!1];v.set(n,r);var e=function(){r[1]=!0};n.then(e,e),n.onCancel=function(n){r[0].add(n)}}}(e);for(var y,h=o(r.d.keys());!(y=h()).done;){var m=y.value;p(n,e,t(m))}r.v=e,delete r.e}else r.v=e,delete r.e;f&&Object.is(l,r.v)||(++r.n,s&&(a=s,i=e,(u=v.get(a))&&(u[1]=!0,u[0].forEach((function(n){return n(i)})))))},M=function(n,r,e){var o=t(r);if(s(o)){if(o.m&&(null==e||!e.has(r)))return o;if(Array.from(o.d).every((function(r){var t=r[0],a=r[1];return M(n,t,e).n===a})))return o}o.d.clear();var i,v,c=!0,p={get signal(){return i||(i=new AbortController),i.signal},get setSelf(){return!v&&l(r)&&(v=function(){if(!c){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return x.apply(void 0,[r].concat(e))}}),v}};try{var w=a(r,(function(a){if(u(r,a)){var i=t(a);if(!s(i)){if(!f(a))throw new Error("no atom init");k(a,i,a.init)}return y(i)}var l=M(n,a,e);try{return y(l)}finally{if(c)h(n,r,o,a,l);else{var v=m();h(v,r,o,a,l),z(v,r,o),S(v)}}}),p);if(k(r,o,w),d(w)){null==w.onCancel||w.onCancel((function(){var n;return null==(n=i)?void 0:n.abort()}));var g=function(){if(o.m){var n=m();z(n,r,o),S(n)}};w.then(g,g)}return o}catch(n){return delete o.v,o.e=n,++o.n,o}finally{c=!1}},E=function(n,r,e){for(var a,i,u=new Map,f=o((null==(l=e.m)?void 0:l.t)||[]);!(i=f()).done;){var l,v=i.value,c=t(v);c.m&&u.set(v,c)}for(var d,s=o(e.p);!(d=s()).done;){var y=d.value;u.set(y,t(y))}return null==(a=function(n,r){return n[0].get(r)}(n,r))||a.forEach((function(n){u.set(n,t(n))})),u};var j=function(n,r,e){for(var t=function(n,r,e){for(var t=[],a=new Set,i=new Set,u=[[r,e]];u.length>0;){var f=u[u.length-1],l=f[0],v=f[1];if(i.has(l))u.pop();else if(a.has(l))t.push([l,v,v.n]),i.add(l),u.pop();else{a.add(l);for(var c,d=o(E(n,l,v));!(c=d()).done;){var s=c.value,y=s[0],p=s[1];l===y||a.has(y)||u.push([y,p])}}}return[t,i]}(n,r,e),a=t[0],i=t[1],u=new Set([r]),f=a.length-1;f>=0;--f){for(var l,v=a[f],c=v[0],d=v[1],s=v[2],y=!1,p=o(d.d.keys());!(l=p()).done;){var h=l.value;if(h!==c&&u.has(h)){y=!0;break}}y&&(M(n,c,i),z(n,c,d),s!==d.n&&(w(n,c,d),u.add(c))),i.delete(c)}},C=function(n,r){var e=!0;try{for(var a=arguments.length,o=new Array(a>2?a-2:0),l=2;l<a;l++)o[l-2]=arguments[l];return i.apply(void 0,[r,function(r){return y(M(n,r))},function(a){var o=t(a);try{for(var i=arguments.length,l=new Array(i>1?i-1:0),v=1;v<i;v++)l[v-1]=arguments[v];if(u(r,a)){if(!f(a))throw new Error("atom not writable");var c=o.n,d=l[0];return k(a,o,d),z(n,a,o),void(c!==o.n&&(w(n,a,o),j(n,a,o)))}return C.apply(void 0,[n,a].concat(l))}finally{e||S(n)}}].concat(o))}finally{e=!1}},x=function(n){var r=m();try{for(var e=arguments.length,t=new Array(e>1?e-1:0),a=1;a<e;a++)t[a-1]=arguments[a];return C.apply(void 0,[r,n].concat(t))}finally{S(r)}},z=function(n,r,e){if(e.m&&!c(e.v)){for(var a,i=o(e.d.keys());!(a=i()).done;){var u=a.value;if(!e.m.d.has(u))I(n,u,t(u)).t.add(r),e.m.d.add(u)}for(var f,l=o(e.m.d||[]);!(f=l()).done;){var v=f.value;if(!e.d.has(v)){e.m.d.delete(v);var d=T(n,v,t(v));null==d||d.t.delete(r)}}}},I=function(n,r,e){if(!e.m){M(n,r);for(var a,i=o(e.d.keys());!(a=i()).done;){var u=a.value;I(n,u,t(u)).t.add(r)}if(e.m={l:new Set,d:new Set(e.d.keys()),t:new Set},l(r)){var f,v=e.m,c=function(n,e){var t=!0;f=function(){try{for(var e=arguments.length,a=new Array(e),o=0;o<e;o++)a[o]=arguments[o];return C.apply(void 0,[n,r].concat(a))}finally{t||S(n)}};try{return e()}finally{t=!1}};b(n,(function(){var e=c(n,(function(){return g(r,(function(){return f.apply(void 0,arguments)}))}));e&&(v.u=function(n){return c(n,e)})}))}}return e.m},T=function(n,r,e){if(!e.m||e.m.l.size||Array.from(e.m.t).some((function(n){var e;return null==(e=t(n).m)?void 0:e.d.has(r)})))return e.m;var a=e.m.u;a&&b(n,(function(){return a(n)})),delete e.m;for(var i,u=o(e.d.keys());!(i=u()).done;){var f=i.value,l=T(n,f,t(f));null==l||l.t.delete(r)}},_={get:function(n){return y(M(void 0,n))},set:x,sub:function(n,r){var e=m(),a=t(n),o=I(e,n,a).l;return o.add(r),S(e),function(){o.delete(r);var e=m();T(e,n,a),S(e)}},unstable_derive:function(n){return A.apply(void 0,n(t,a,i,g))}};return _},k=function(){var n=new WeakMap;return A((function(r){var e=n.get(r);return e||(e={d:new Map,p:new Set,n:0},n.set(r,e)),e}),(function(n){for(var r=arguments.length,e=new Array(r>1?r-1:0),t=1;t<r;t++)e[t-1]=arguments[t];return n.read.apply(n,e)}),(function(n){for(var r=arguments.length,e=new Array(r>1?r-1:0),t=1;t<r;t++)e[t-1]=arguments[t];return n.write.apply(n,e)}),(function(n){for(var r=arguments.length,e=new Array(r>1?r-1:0),t=1;t<r;t++)e[t-1]=arguments[t];return null==n.onMount?void 0:n.onMount.apply(n,e)}))};n.atom=function(n,a){var o="atom"+ ++r,i={toString:function(){return o}};return"function"==typeof n?i.read=n:(i.init=n,i.read=e,i.write=t),a&&(i.write=a),i},n.createStore=k,n.getDefaultStore=function(){return i||(i=k()),i}}));
